---
title: "project title"
subtitle: "project subtitle"
author: 
  - a
  - b
  - Kevin You
  - Ziheng Zhong
thanks: "Code and data supporting this analysis is available at: [Link to repository](https://github.com/iJustinn/Global_CO2_Emissions.git)."
date: today
date-format: long
abstract: ""
format: pdf
toc: true
number-sections: true
bibliography: references.bib
---

```{r setup}
#| include: false
#| warning: false
#| message: false

# load library
library(tidyverse)
library(lubridate)
library(gridExtra)
library(forecast)
library(ggplot2)
library(knitr)
library(readr)
library(dplyr)
library(astsa)
library(here)

# load data
co2 <- read.csv(here("data", "owid-co2-data.csv"))

# load model

```

\newpage

# Introduction

Climate change has become a critical global challenge, driven largely by rising carbon dioxide (CO$_2$) emissions from human activities. The Intergovernmental Panel on Climate Change (IPCC) warns that without immediate and deep emission reductions, the world is on track to exceed the Paris Agreement’s 1.5°C warming threshold, underscoring an urgent need to curb CO$_2$ from all sectors [@citeIPCC]. In this context, the United States – historically the single largest national source of CO$_2$ – plays a pivotal role. Cumulatively, the U.S. has emitted roughly 25% of all fossil-fuel CO$_2$ since the industrial era began [@citeOwid], and it remains one of the top annual emitters today. Understanding the trajectory of U.S. emissions, especially from major sectors like transportation, industry, and energy generation, is therefore of global importance for climate change mitigation.

This project focuses on analyzing the effect of U.S. transportation, industry, and energy generation on CO$_2$ emissions from 1750 up to 2023. Using historical emissions data from the Our World in Data's dataset [@citeData], we examine how these three key sectors have contributed to national CO$_2$ output over time. The study not only reviews historical trends but also develops forecasts for future emissions, providing both a retrospective and forward-looking perspective on U.S. CO$_2$ emissions.

The motivation for this research is grounded in climate and energy policy relevance. The chosen sectors – transportation, industrial production, and power generation – are the dominant sources of U.S. greenhouse gas emissions [@citeEnergyConsumption]. For example, in 2019 the transportation sector accounted for about 29% of U.S. CO$_2$-equivalent emissions, followed by electricity generation (∼25%) and industrial processes (∼23%) [@citeEnergyConsumption]. These activities collectively drive the bulk of national emissions, meaning any meaningful climate strategy must address each of them. Analyzing historical patterns in these sectors can reveal how past economic growth, technological changes, and policies (such as vehicle efficiency standards or power plant regulations) have impacted emissions. Moreover, forecasting future emissions is crucial for gauging progress toward sustainability goals. The U.S. has set ambitious targets under the Paris Agreement – pledging a 50–52% reduction in greenhouse gases by 2030 (from 2005 levels) and net-zero emissions by 2050 [@citeEnergyConsumption] – which heightens the real-world significance of this study. By projecting emissions trajectories, we can assess whether current trends align with these climate goals or if additional policy interventions may be required.

The paper is structured as follows: @sec-method TBD, @sec-result TBD, @sec-discussion TBD.

# Method {#sec-method}

## Data

The dataset is sourced from the the U.S. Energy Information Administration’s (EIA) Monthly Energy Review that issues detailed energy statistics, including production, consumption, trade, and emissions metrics. The Monthly Energy Review is released on the last workday of each month and contains preliminary data that are subject to revision in subsequent releases, as well as historical data that may be updated when source publications are revised. For this project, data were extracted for the period ranging from January 1973 to February 2025, with a total of 626 records at a monthly frequency. The EIA collects these data through standardized survey forms completed by energy industry participants, following review protocols approved every three years to ensure consistency and quality across reporting entities.

```{r}
#| label: tbl-summary
#| echo: false
#| warning: false
#| message: false

data <- read.csv("../Data/cleaned_data.csv")


data <- data %>%
  mutate(
    Date = as.Date(paste(Year, Month, "1", sep = "-"), format = "%Y-%m-%d")
  )

ggplot(data, aes(x = Date, y = Total_CO2_Emissions)) +
  geom_line(size = 1) +
  labs(
    title = "Total CO2 Emissions Over Time",
    x     = "Date",
    y     = "Total CO2 Emissions (million metric tons)"
  ) +
  theme_minimal()


data_zoom <- data %>%
  filter(Date >= as.Date("2015-01-01") & Date <= as.Date("2020-12-31"))


ggplot(data_zoom, aes(x = Date, y = Total_CO2_Emissions)) +
  geom_line(size = 1) +
  labs(
    title = "Total CO2 Emissions (2015–2020)",
    x     = "Date",
    y     = "Total CO2 Emissions (million metric tons)"
  ) +
  theme_minimal() +
  scale_x_date(date_breaks = "6 months", date_labels = "%Y-%m")  

acf(
  data$Total_CO2_Emissions,
  main = "ACF of Total CO2 Emissions",
  xlab = "Lag",
  ylab = "Autocorrelation"
)
```

Key variables included in the cleaned dataset are total $CO_2$ emissions (million metric tons), transportation petroleum consumption (million barrels per day), total fossil fuels production and total renewable energy production (quadrillion British thermal units [Btu]), and sectoral energy consumption in the commercial, industrial, and residential sectors (trillion Btu). Units adhere to the conventions of the Monthly Energy Review, with energy metrics predominantly expressed in U.S. customary units—such as Btu for energy and barrels for petroleum volumes—and emissions in metric units.

From plot 1, we can say that from the early 1970s through 2005, total CO2 emissions has a clear upward trend, and then a decay from 2005 to present. The sharp dip around 2020 likely reflects the economic slowdown during the COVID‑19 pandemic, everyone is in quarantine, hence there is less traffic and fossil fuel usage, which could be the reason of the dip.

By observing the ACF plot, we can conclude that the total CO2 emission is non-stationary since the lag‑1 autocorrelation is essentially 1.0, and the ACF decays very slowly, confirming the presence of non-stationary mean in the series.

## Model

First, run an ordinary regression of $y_t$ on $z_{t1}$, ··· , $z_{tr}$ (acting as if the
errors are uncorrelated). Retain the residuals,
$\hat{x}_{t} = y_t-\sum^{r}_{j=1}\beta_{j} z_{tj}$.


Second, Identify ARMA model(s) for the residuals $\hat{x}_t$.


Third, Run weighted least squares (or MLE) on the regression model with autocorrelated errors using the model specified in step (ii).


Fourth, Inspect the residuals $\hat{w}_t$ for whiteness, and adjust the model if necessary.

### Model 1

```{r}
data_train <- data[data$Year <= 2020, ]
data_test  <- data[data$Year > 2020, ]

model1 <- lm(
  Total_CO2_Emissions ~ . 
    - Date - Year - Month,
  data = data_train
)

summary(model1)

```

```{r}
plot(model1$fitted.values, resid(model1),
     xlab = "Fitted Values",
     ylab = "Residuals",
     main = "Residuals vs Fitted")
abline(h = 0, col = "red")

plot(data_train$Date, resid(model1),
     type = "l",
     xlab = "Date",
     ylab = "Residuals",
     main = "Residuals Over Time")
abline(h = 0, col = "red")


hist(resid(model1),
     breaks = 30,
     main = "Histogram of Residuals",
     xlab = "Residuals")

# Residuals satisfied identical normal distribution
qqnorm(resid(model1))
qqline(resid(model1), col = "red")
```

```{r}
acf(resid(model1), main = "ACF of Residuals")
pacf(resid(model1), main = "PACF of Residuals")

# ljung-box test shows that the residuals are auto-correlated
Box.test(resid(model1), lag = 20, type = "Ljung-Box")  

```

```{r}
# auto fitted arima
resid_ts <- ts(resid(model1))
resid_arima <- auto.arima(resid_ts)
summary(resid_arima)
```

```{r}
forecast::auto.arima(resid(model1))
```

```{r}
y_hat_lm <- fitted(model1) 

resid_hat_arima <- fitted(resid_arima)
y_hat_combined <- y_hat_lm + resid_hat_arima

plot(data_train$Date, data_train$Total_CO2_Emissions, type = "l", col = "black", lwd = 2,
     ylab = "Total CO2 Emissions (million metric tons)",
     xlab = "Date",
     main = "Combined Model Fit",
     cex.lab = 1.2, cex.main = 1.4)

lines(data_train$Date, y_hat_combined, col = "red", lwd = 2)

legend("topright",
       legend = c("Observed", "LM + ARIMA Fit"),
       col = c("black", "red"),
       lty = 1,
       lwd = 2,
       cex = 1.1,
       bty = "n") 
```

```{r}
y_true <- data_train$Total_CO2_Emissions
y_lm   <- fitted(model1)

plot(data_train$Date, y_true, type = "l", col = "black", lwd = 2,
     ylab = "Total CO2 Emissions (million metric tons)",
     xlab = "Date",
     main = "Linear Model Fit vs Actual",
     cex.lab = 1.2, cex.main = 1.4)

lines(data_train$Date, y_lm, col = "red", lwd = 2)

legend("topright",
       legend = c("Observed", "Linear Model Fit"),
       col = c("black", "red"),
       lty = 1,
       lwd = 2,
       cex = 1.1,
       bty = "n")
```

```{r}

rss_lm <- sum((y_true - y_lm)^2)
rss_combined <- sum((y_true - y_hat_combined)^2)

cat("RSS of Linear Model:", rss_lm, "\n")
cat("RSS of Linear + ARIMA Model:", rss_combined, "\n")

rmse_lm <- sqrt(mean((y_true - y_lm)^2))
rmse_combined <- sqrt(mean((y_true - y_hat_combined)^2))

cat("RMSE of Linear Model:", rmse_lm, "\n")
cat("RMSE of Linear + ARIMA Model:", rmse_combined, "\n")
```

```{r}
# Predict data adter 2020
pred_result <- predict(model1, newdata = data_test, interval = "prediction", level = 0.95)

y_test_true <- data_test$Total_CO2_Emissions
y_test_pred <- pred_result[, "fit"]
y_test_lower <- pred_result[, "lwr"]
y_test_upper <- pred_result[, "upr"]

plot(data_test$Date, y_test_true, type = "l", col = "black", lwd = 2,
     ylab = "Total CO2 Emissions (million metric tons)",
     xlab = "Date",
     main = "Out-of-Sample Forecast with 95% Prediction Interval",
     cex.lab = 1.2, cex.main = 1.4)

lines(data_test$Date, y_test_pred, col = "blue", lwd = 2)
lines(data_test$Date, y_test_lower, col = "blue", lty = 2, lwd = 1.5)
lines(data_test$Date, y_test_upper, col = "blue", lty = 2, lwd = 1.5)

legend("topright",
       legend = c("Observed", "Predicted", "95% Prediction Interval"),
       col = c("black", "blue", "blue"),
       lty = c(1, 1, 2),
       lwd = 2,
       cex = 1.1,
       bty = "n")
```

```{r}

```

### Model 2

```{r}
# forecast::auto.arima(resid(model1))
```


# Result {#sec-result}

# Discussion {#sec-discussion}

# Appendix

## Project Code

\newpage

# References
